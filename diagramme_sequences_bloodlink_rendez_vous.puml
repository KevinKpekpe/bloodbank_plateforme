@startuml Diagramme de Séquences - BloodLink - Prise de Rendez-vous

!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60

title **Processus de Prise de Rendez-vous - BloodLink**

actor "Donneur" as Donor
actor "Admin Banque" as BankAdmin

participant "Interface Web" as UI
participant "AppointmentController" as AppointmentCtrl
participant "Donor Model" as DonorModel
participant "Appointment Model" as AppointmentModel
participant "Bank Model" as BankModel

database "Base de Données" as DB

== **Processus de Prise de Rendez-vous** ==

note over Donor, AppointmentCtrl : **Étape 1: Accès au formulaire**
Donor -> UI: Accès à "Prendre Rendez-vous"
UI -> AppointmentCtrl: Demander formulaire de rendez-vous
AppointmentCtrl -> BankModel: Récupérer banques actives
BankModel -> DB: Rechercher banques actives
DB --> BankModel: Retourner liste des banques
BankModel --> AppointmentCtrl: Retourner banques disponibles
AppointmentCtrl --> UI: Retourner formulaire avec banques
UI -> Donor: Afficher formulaire avec banques

note over Donor, AppointmentCtrl : **Étape 2: Validation et création**
Donor -> UI: Remplir formulaire (banque, date, heure)
UI -> AppointmentCtrl: Envoyer données de rendez-vous

AppointmentCtrl -> DonorModel: Vérifier profil donneur
DonorModel -> DB: Rechercher profil donneur
DB --> DonorModel: Retourner profil donneur
DonorModel --> AppointmentCtrl: Retourner profil trouvé

AppointmentCtrl -> BankModel: Vérifier disponibilité banque
BankModel -> DB: Rechercher banque
DB --> BankModel: Retourner détails banque
BankModel --> AppointmentCtrl: Retourner banque disponible

AppointmentCtrl -> AppointmentModel: Vérifier conflit de rendez-vous
AppointmentModel -> DB: Rechercher rendez-vous existants
DB --> AppointmentModel: Retourner rendez-vous existants
AppointmentModel --> AppointmentCtrl: Retourner résultat vérification

alt Aucun conflit détecté
    AppointmentCtrl -> AppointmentModel: Créer nouveau rendez-vous
    AppointmentModel -> DB: Enregistrer rendez-vous
    DB --> AppointmentModel: Confirmer création
    AppointmentModel --> AppointmentCtrl: Retourner rendez-vous créé
    AppointmentCtrl --> UI: Retourner succès
    UI -> Donor: Afficher confirmation de création
else Conflit détecté
    AppointmentCtrl --> UI: Retourner erreur de conflit
    UI -> Donor: Afficher message d'erreur
end

@enduml
