@startuml Diagramme de Séquences - BloodLink - Gestion des Dons

!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60

title **Processus de Gestion des Dons - BloodLink**

actor "Admin Banque" as BankAdmin

participant "Interface Web" as UI
participant "AppointmentController" as AppointmentCtrl
participant "DonationController" as DonationCtrl
participant "NotificationService" as NotifService
participant "Donor Model" as DonorModel
participant "Appointment Model" as AppointmentModel
participant "Donation Model" as DonationModel
participant "BloodStock Model" as StockModel

database "Base de Données" as DB

== **Processus de Don de Sang** ==

note over BankAdmin, AppointmentCtrl : **Étape 1: Enregistrement du don**
BankAdmin -> UI: Marquer rendez-vous comme terminé
UI -> AppointmentCtrl: Envoyer données du don (volume)

AppointmentCtrl -> DonorModel: Récupérer groupe sanguin
DonorModel -> DB: Rechercher groupe sanguin donneur
DB --> DonorModel: Retourner groupe sanguin
DonorModel --> AppointmentCtrl: Retourner groupe sanguin

AppointmentCtrl -> DonationModel: Créer enregistrement de don
DonationModel -> DB: Enregistrer don
DB --> DonationModel: Confirmer création du don
DonationModel --> AppointmentCtrl: Retourner don créé

AppointmentCtrl -> StockModel: Mettre à jour stock
StockModel -> DB: Rechercher stock existant
DB --> StockModel: Retourner stock actuel
StockModel -> DB: Mettre à jour quantité
DB --> StockModel: Confirmer mise à jour
StockModel --> AppointmentCtrl: Retourner stock actualisé

AppointmentCtrl -> AppointmentModel: Marquer rendez-vous terminé
AppointmentModel -> DB: Mettre à jour statut rendez-vous
DB --> AppointmentModel: Confirmer mise à jour
AppointmentModel --> AppointmentCtrl: Retourner rendez-vous terminé
AppointmentCtrl --> UI: Retourner succès
UI -> BankAdmin: Afficher confirmation

== **Processus de Gestion des Dons** ==

note over BankAdmin, DonationCtrl : **Étape 1: Consultation des dons**
BankAdmin -> UI: Accès à la gestion des dons
UI -> DonationCtrl: Demander liste des dons
DonationCtrl -> DonationModel: Récupérer dons de la banque
DonationModel -> DB: Rechercher dons
DB --> DonationModel: Retourner liste des dons
DonationModel --> DonationCtrl: Retourner dons récupérés
DonationCtrl --> UI: Retourner liste des dons
UI -> BankAdmin: Afficher interface de gestion

note over BankAdmin, DonationCtrl : **Étape 2: Traitement d'un don**
BankAdmin -> UI: Marquer don comme traité
UI -> DonationCtrl: Demander traitement du don
DonationCtrl -> DonationModel: Mettre à jour statut
DonationModel -> DB: Mettre à jour statut don
DB --> DonationModel: Confirmer mise à jour
DonationModel --> DonationCtrl: Retourner don traité

DonationCtrl -> NotifService: Envoyer notification de traitement
NotifService -> DB: Enregistrer notification
DB --> NotifService: Confirmer enregistrement
NotifService --> DonationCtrl: Retourner notification envoyée
DonationCtrl --> UI: Retourner succès
UI -> BankAdmin: Afficher confirmation de traitement

note over BankAdmin, DonationCtrl : **Étape 3: Mise à disposition**
BankAdmin -> UI: Rendre don disponible
UI -> DonationCtrl: Demander mise à disposition
DonationCtrl -> DonationModel: Mettre à jour statut disponible
DonationModel -> DB: Mettre à jour statut
DB --> DonationModel: Confirmer mise à jour
DonationModel --> DonationCtrl: Retourner don disponible

DonationCtrl -> NotifService: Envoyer notification de disponibilité
NotifService -> DB: Enregistrer notification
DB --> NotifService: Confirmer enregistrement
NotifService --> DonationCtrl: Retourner notification envoyée
DonationCtrl --> UI: Retourner succès
UI -> BankAdmin: Afficher confirmation de disponibilité

@enduml
